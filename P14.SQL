CREATE TABLE P14(
	WORKFLOW VARCHAR(255),
	[STEP NUMBER] INT,
	[STATUS] VARCHAR(255)
);

INSERT INTO
	P14
VALUES
('ALPHA', 1, 'ERROR'),
	('ALPHA', 2, 'COMPLETE'),
	('ALPHA', 3, 'RUNNIG'),
	('BRAVO', 1, 'COMPLETE'),
	('BRAVO', 2, 'COMPLETE'),
	('CHARLIE', 1, 'RUNNING'),
	('CHARLIE', 2, 'RUNNING'),
	('DELTA', 1, 'ERROR'),
	('DELTA', 2, 'ERROR'),
	('ECHO', 1, 'RUNNING'),
	('ECHO', 2, 'COMPLETE')
SELECT
	DISTINCT WORKFLOW,
	'INTERMEDIATE' STATUS
FROM
	P14 A
WHERE
	'ERROR' IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
	AND 'COMPLETE' IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
UNION
SELECT
	DISTINCT WORKFLOW,
	'INTERMEDIATE'
FROM
	P14 A
WHERE
	'ERROR' IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
	AND 'RUNNING' IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
UNION
SELECT
	DISTINCT WORKFLOW,
	'RUNNING'
FROM
	P14 A
WHERE
	'ERROR' NOT IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
	AND 'RUNNING' IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
	AND 'COMPLETE' IN (
		SELECT
			STATUS
		FROM
			P14 B
		WHERE
			A.WORKFLOW = B.WORKFLOW
	)
UNION
SELECT
	DISTINCT WORKFLOW,
	STATUS
FROM
	P14
WHERE
	WORKFLOW NOT IN (
		SELECT
			DISTINCT WORKFLOW
		FROM
			P14 A
		WHERE
			'ERROR' IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
			AND 'COMPLETE' IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
		UNION
		SELECT
			DISTINCT WORKFLOW
		FROM
			P14 A
		WHERE
			'ERROR' IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
			AND 'RUNNING' IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
		UNION
		SELECT
			DISTINCT WORKFLOW
		FROM
			P14 A
		WHERE
			'ERROR' NOT IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
			AND 'RUNNING' IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
			AND 'COMPLETE' IN (
				SELECT
					STATUS
				FROM
					P14 B
				WHERE
					A.WORKFLOW = B.WORKFLOW
			)
)